import{b as e,r as i,j as g,L as A,P as D,C as H,w as R,H as T,D as z,h as _}from"./vendor.47a03c39.js";import{a as C,i as w,F as O,l as k,L as U,b as I,n as W}from"./index.1f299675.js";var X={"personal-fm":"_personal-fm_ltzr1_1"};const q=()=>C(`/personal_fm?_t=${Date.now()}`),G=m=>C(`/fm_trash?id=${m}`);function Q(){if(!w())return e("div",{children:"\u79C1\u4EBA FM \u9700\u8981\u767B\u5F55\u4F7F\u7528"});const{pauseSong:m,collectSong:E}=i.exports.useContext(O);i.exports.useEffect(()=>{document.title="\u79C1\u4EBAFM"},[]),i.exports.useEffect(()=>{const s=document.getElementsByClassName(k.middle)[0],n=document.getElementsByClassName(k.bottom)[0];s.style.height="calc(100% - 64px)",s.style.transition="height 1s",n.style.display="none";const t=document.getElementById("toggleList");t.checked&&t.click(),m();let o=null;return navigator.mediaSession&&(o=navigator.mediaSession.metadata),()=>{s.style.height="calc(100% - 128px)",n.style.display="block",setTimeout(()=>{s.style.transition=""},1e3),o&&(navigator.mediaSession.metadata=o)}},[]);const[N,f]=i.exports.useState(!1),[a,y]=i.exports.useState(null),[u,h]=i.exports.useState([]),[l,d]=i.exports.useState(!1),r=i.exports.useRef(null),v=i.exports.useRef(null),p=i.exports.useRef(null);i.exports.useEffect(()=>{if(u.length>0)return;(async()=>{const n=await q(),t=I(n.data,"fm");if(!a){const o=t.pop();y(o)}h(t)})()},[u]);const j=()=>{l?r.current.pause():r.current.play(),d(!l)},F=()=>{f(!0),E(a.id)},L=()=>{G(a.id),c()},c=()=>{if(u.length===0)return;const s=u.slice(),n=s.pop();y(n),h(s),f(!1)},M=s=>{const n=p.current,t=(s.pageX-n.offsetLeft)/n.clientWidth;r.current.currentTime=t*a.duration},P=()=>{l&&r.current.play()},$=s=>{const n=s.target.currentTime/a.duration*100+"%",t="-"+W(a.duration-s.target.currentTime);v.current.style.setProperty("--time",`'${t}'`),p.current.style.setProperty("--progress",n)};if(i.exports.useEffect(()=>{if(!a||!navigator.mediaSession||!MediaMetadata)return;const{name:s,singers:n,cover:t,albumName:o}=a;navigator.mediaSession.metadata=new MediaMetadata({title:s,artist:n.map(B=>B.name).join("/"),album:o,artwork:[{src:`${t}?param=96y96`,sizes:"96x96",type:"image/jpeg"},{src:`${t}?param=128y128`,sizes:"128x128",type:"image/jpeg"},{src:`${t}?param=192y192`,sizes:"192x192",type:"image/jpeg"},{src:`${t}?param=256y256`,sizes:"256x256",type:"image/jpeg"},{src:`${t}?param=384y384`,sizes:"384x384",type:"image/jpeg"},{src:`${t}?param=512y512`,sizes:"512x512",type:"image/jpeg"}]})},[a]),i.exports.useEffect(()=>{!a||!navigator.mediaSession||!MediaMetadata||(navigator.mediaSession.setActionHandler("play",()=>{r.current.play(),d(!0)}),navigator.mediaSession.setActionHandler("pause",()=>{r.current.pause(),d(!1)}),navigator.mediaSession.setActionHandler("stop",()=>{r.current.pause(),d(!1)}),navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("nexttrack",c))},[a,c]),!a)return e(U,{});const{id:x,name:S,cover:b}=a;return g("div",{className:X["personal-fm"],children:[e("div",{className:"title",children:"\u79C1\u4EBAFM"}),g("div",{className:"music-box",children:[e("div",{className:"image",children:e("img",{src:`${b}?param=300y300`})}),e(A,{className:"song",to:`/Song?id=${x}`,target:"_blank",title:S,children:S}),e("div",{className:"progress-container",ref:v,children:e("div",{className:"progress",ref:p,onClick:M})}),g("div",{className:"btn-container",children:[e("div",{className:"icon",title:l?"\u6682\u505C":"\u64AD\u653E",onClick:j,children:l?e(D,{}):e(H,{})}),e("div",{className:"icon",title:"\u559C\u6B22",onClick:F,children:N?e(R,{style:{color:"#c62f2f"}}):e(T,{})}),e("div",{className:"icon",title:"\u4E0D\u559C\u6B22",onClick:L,children:e(z,{})}),e("div",{className:"icon",title:"\u4E0B\u4E00\u9996",onClick:c,children:e(_,{})})]})]}),e("audio",{ref:r,src:`https://music.163.com/song/media/outer/url?id=${x}`,onEnded:c,onCanPlay:P,onTimeUpdate:$})]})}export{Q as default};
