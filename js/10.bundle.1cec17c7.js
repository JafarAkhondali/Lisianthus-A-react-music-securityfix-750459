(window.webpackJsonp=window.webpackJsonp||[]).push([[10,31],{200:function(e,t,n){"use strict";n.r(t);n(72),n(469),n(97),n(69),n(86),n(120),n(89),n(87),n(88),n(56),n(90),n(61),n(70),n(77),n(91),n(71);var g=n(0),y=n.n(g),b=n(461),h=n(95),E=n(85),j=n(488),w=n(489),O=n(498),k=n(484),x=n(492),S=n(490),a=n(135),H=n.n(a),N=n(229),a=(n(234),n(230),n(39)),r=n.n(a);function s(e,t,n,a,r,c,i){try{var o=e[c](i),s=o.value}catch(e){return void n(e)}o.done?t(s):Promise.resolve(s).then(a,r)}function c(o){return function(){var e=this,i=arguments;return new Promise(function(t,n){var a=o.apply(e,i);function r(e){s(a,t,n,r,c,"next",e)}function c(e){s(a,t,n,r,c,"throw",e)}r(void 0)})}}var T=function(){var e=c(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r()("/personal_fm?timestamp=".concat(Date.now()));case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),C=function(){var t=c(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r()("/fm_trash?id=".concat(t));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),_=n(25),A=n(185);function M(e,t,n,a,r,c,i){try{var o=e[c](i),s=o.value}catch(e){return void n(e)}o.done?t(s):Promise.resolve(s).then(a,r)}function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,c=[],i=!0,o=!1;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(c.push(a.value),!t||c.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(o)throw r}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}t.default=function(){if(!Object(_.hasToken)())return y.a.createElement("div",null,"私人FM需要登录使用");var i=N.d.audioRef,o=N.d.setPlaying;Object(g.useEffect)(function(){document.title="私人FM"}),Object(g.useEffect)(function(){var e=document.getElementsByClassName(h.a.middle)[0],t=document.getElementsByClassName(h.a.bottom)[0];e.style.height="calc(100% - 64px)",e.style.transition="height 1s",t.style.display="none";var n=i.current,a=n.src,r=n.currentTime;toggleList.checked&&toggleList.click(),o(!1),i.current.currentTime=0,i.current.src="#";var c=null;return navigator.mediaSession&&(c=navigator.mediaSession.metadata),function(){e.style.height="calc(100% - 128px)",t.style.display="block",setTimeout(function(){return e.style.transition=""},1e3),i.current.src=a,i.current.currentTime=r,c&&(navigator.mediaSession.metadata=c)}},[]);var e=P(Object(g.useState)(!1),2),t=e[0],n=e[1],a=P(Object(g.useState)(null),2),r=a[0],c=a[1],e=P(Object(g.useState)([]),2),s=e[0],u=e[1],a=P(Object(g.useState)(!1),2),l=a[0],m=a[1],p=Object(g.useRef)(null),f=Object(g.useRef)(null),d=Object(g.useRef)(null);Object(g.useEffect)(function(){0<s.length||function(){var o,e=(o=regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T();case 2:n=e.sent,t=n.data.map(function(e){var t=e.id,n=e.name,a=e.duration,r=e.artists,c=e.album,e=c.picUrl;return{id:t,albumName:c.name,title:n,singers:r,duration:a/1e3,cover:e}}),r||(n=t.pop(),c(n)),u(t);case 6:case"end":return e.stop()}},e)}),function(){var e=this,i=arguments;return new Promise(function(t,n){var a=o.apply(e,i);function r(e){M(a,t,n,r,c,"next",e)}function c(e){M(a,t,n,r,c,"throw",e)}r(void 0)})});return function(){return e.apply(this,arguments)}}()()},[s]);var e=function(){l?p.current.pause():p.current.play(),m(!l)},a=function(){n(!0),Object(A.a)(r.id)},v=function(){var e,t;0!==s.length&&(t=(e=s.slice()).pop(),c(t),u(e),n(!1))};return Object(g.useEffect)(function(){var e,t,n,a;r&&navigator.mediaSession&&MediaMetadata&&(e=r.name,t=r.singers,n=r.cover,a=r.albumName,navigator.mediaSession.metadata=new MediaMetadata({title:e,artist:t.map(function(e){return e.name}).join("/"),album:a,artwork:[{src:"".concat(Object(_.replaceHttpToHttps)(n),"?param=96y96"),sizes:"96x96",type:"image/jpeg"},{src:"".concat(Object(_.replaceHttpToHttps)(n),"?param=128y128"),sizes:"128x128",type:"image/jpeg"},{src:"".concat(Object(_.replaceHttpToHttps)(n),"?param=192y192"),sizes:"192x192",type:"image/jpeg"},{src:"".concat(Object(_.replaceHttpToHttps)(n),"?param=256y256"),sizes:"256x256",type:"image/jpeg"},{src:"".concat(Object(_.replaceHttpToHttps)(n),"?param=384y384"),sizes:"384x384",type:"image/jpeg"},{src:"".concat(Object(_.replaceHttpToHttps)(n),"?param=512y512"),sizes:"512x512",type:"image/jpeg"}]}))},[r]),Object(g.useEffect)(function(){r&&navigator.mediaSession&&MediaMetadata&&(navigator.mediaSession.setActionHandler("play",function(){p.current.play(),m(!0)}),navigator.mediaSession.setActionHandler("pause",function(){p.current.pause(),m(!1)}),navigator.mediaSession.setActionHandler("stop",function(){p.current.pause(),m(!1)}),navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("nexttrack",v))},[r,v]),r?y.a.createElement("div",{className:b.default["personal-fm"]},y.a.createElement("div",{className:b.default.title},"私人FM"),y.a.createElement("div",{className:b.default["music-box"]},y.a.createElement("div",{className:b.default.image},y.a.createElement("img",{src:"".concat(Object(_.replaceHttpToHttps)(r.cover),"?param=300y300")})),y.a.createElement(E.b,{className:b.default.song,to:"/Song?id=".concat(r.id),target:"_blank",title:r.title},r.title),y.a.createElement("div",{className:b.default["progress-container"],ref:f},y.a.createElement("div",{className:b.default.progress,ref:d,onClick:function(e){var t=d.current,t=(e.pageX-t.offsetLeft)/t.clientWidth;p.current.currentTime=t*r.duration}})),y.a.createElement("div",{className:b.default["btn-container"]},l?y.a.createElement("div",{className:b.default.icon,title:"暂停",onClick:e},y.a.createElement(j.a,null)):y.a.createElement("div",{className:b.default.icon,title:"播放",onClick:e},y.a.createElement(w.a,null)),t?y.a.createElement("div",{className:b.default.icon,title:"喜欢",onClick:a},y.a.createElement(O.a,{style:{color:"#C62F2F"}})):y.a.createElement("div",{className:b.default.icon,title:"喜欢",onClick:a},y.a.createElement(k.a,null)),y.a.createElement("div",{className:b.default.icon,title:"不喜欢",onClick:function(){C(r.id),v()}},y.a.createElement(x.a,null)),y.a.createElement("div",{className:b.default.icon,title:"下一首",onClick:v},y.a.createElement(S.a,null)))),y.a.createElement("audio",{ref:p,src:"https://music.163.com/song/media/outer/url?id=".concat(r.id),onEnded:v,onCanPlay:function(e){l&&e.target.play()},onTimeUpdate:function(e){var t=e.target.currentTime/r.duration*100+"%",e="-"+Object(_.convertTime)(r.duration-e.target.currentTime);f.current.style.setProperty("--time","'".concat(e,"'")),d.current.style.setProperty("--progress",t)}})):y.a.createElement(H.a,null)}},461:function(e,t,n){"use strict";n.r(t),t.default={"personal-fm":"personal-fm_27kHT",title:"title_DN0r-","music-box":"music-box_1c1Fm",image:"image_3P-kP",song:"song_G9sNu","progress-container":"progress-container_3KUWt",progress:"progress_1fvvk","btn-container":"btn-container_xwmLI",icon:"icon_2apsd"}}}]);